{
  "machineContents": {
    "scanner-workstation": {
      "type": "attacker",
      "tools": [
        "nmap",
        "wireshark",
        "tcpdump",
        "netcat",
        "hping3",
        "masscan",
        "ssh",
        "nc",
        "net-tools",
        "iputils-ping",
        "python3",
        "curl",
        "wget",
        "git",
        "vim",
        "nano",
        "bash",
        "ftp",
        "lftp",
        "telnet",
        "ssh-client",
        "smbclient",
        "nfs-common",
        "snmp",
        "tftp"
      ]
    },
    "legacy-unix-server": {
      "name": "legacy-unix-server",
      "type": "victim",
      "role": "Legacy Unix system running multiple network services",
      "services": [
        "ssh",
        "ftp",
        "telnet",
        "smtp",
        "pop3",
        "finger",
        "rsh",
        "rlogin"
      ],
      "files": [
        {
          "name": "nfs_exports",
          "path": "/etc",
          "content": "# NFS exports configuration\n# Legacy Unix server - development environment\n/home/devteam *(rw,no_root_squash,no_subtree_check)\n/opt/legacy_apps 192.168.1.0/24(ro,no_subtree_check)\n/var/backups *(rw,sync,no_root_squash)\n/tmp/shared_workspace *(rw,no_root_squash,insecure)\n"
        },
        {
          "name": "vsftpd.conf",
          "path": "/etc/vsftpd",
          "content": "listen=YES\nlisten_ipv6=NO\nanonymous_enable=YES\nlocal_enable=YES\nwrite_enable=YES\nlocal_umask=022\nanon_upload_enable=YES\nanon_mkdir_write_enable=YES\ndirmessage_enable=YES\nxferlog_enable=YES\nconnect_from_port_20=YES\nxferlog_std_format=YES\nchroot_local_user=YES\nsecure_chroot_dir=/var/run/vsftpd/empty\npam_service_name=vsftpd\nrsa_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem\nrsa_private_key_file=/etc/ssl/private/ssl-cert-snakeoil.key\nssl_enable=NO\nftp_data_port=20\nport_enable=YES\npasv_enable=YES\npasv_min_port=21100\npasv_max_port=21110\nallow_anon_ssl=NO\nforce_local_data_ssl=NO\nforce_local_logins_ssl=NO\n"
        },
        {
          "name": "sshd_config",
          "path": "/etc/ssh",
          "content": "Port 22\nProtocol 2\nHostKey /etc/ssh/ssh_host_rsa_key\nHostKey /etc/ssh/ssh_host_dsa_key\nHostKey /etc/ssh/ssh_host_ecdsa_key\nHostKey /etc/ssh/ssh_host_ed25519_key\nUsePrivilegeSeparation yes\nKeyRegenerationInterval 3600\nServerKeyBits 1024\nSyslogFacility AUTH\nLogLevel INFO\nLoginGraceTime 120\nPermitRootLogin yes\nStrictModes yes\nRSAAuthentication yes\nPubkeyAuthentication yes\nIgnoreRhosts no\nRhostsRSAAuthentication no\nHostbasedAuthentication yes\nIgnoreUserKnownHosts no\nPermitEmptyPasswords yes\nChallengeResponseAuthentication no\nPasswordAuthentication yes\nX11Forwarding yes\nX11DisplayOffset 10\nPrintMotd no\nPrintLastLog yes\nTCPKeepAlive yes\nAcceptEnv LANG LC_*\nSubsystem sftp /usr/lib/openssh/sftp-server\nUsePAM yes\n"
        },
        {
          "name": "telnetd.conf",
          "path": "/etc/xinetd.d",
          "content": "service telnet\n{\n    disable = no\n    flags = REUSE\n    socket_type = stream\n    wait = no\n    user = root\n    server = /usr/sbin/in.telnetd\n    log_on_failure += USERID\n    bind = 0.0.0.0\n    port = 23\n}\n"
        },
        {
          "name": "fingerd",
          "path": "/etc/xinetd.d",
          "content": "service finger\n{\n    disable = no\n    socket_type = stream\n    wait = no\n    user = nobody\n    server = /usr/sbin/in.fingerd\n    server_args = -w\n    log_on_success += USERID\n    log_on_failure += USERID\n    port = 79\n}\n"
        },
        {
          "name": "rshd",
          "path": "/etc/xinetd.d",
          "content": "service shell\n{\n    disable = no\n    socket_type = stream\n    wait = no\n    user = root\n    server = /usr/sbin/in.rshd\n    log_on_success += USERID\n    log_on_failure += USERID\n    port = 514\n}\n"
        },
        {
          "name": "rlogind",
          "path": "/etc/xinetd.d",
          "content": "service login\n{\n    disable = no\n    socket_type = stream\n    wait = no\n    user = root\n    server = /usr/sbin/in.rlogind\n    log_on_success += USERID\n    log_on_failure += USERID\n    port = 513\n}\n"
        },
        {
          "name": "main.cf",
          "path": "/etc/postfix",
          "content": "smtpd_banner = $myhostname ESMTP $mail_name (Unix)\nbiff = no\nappend_dot_mydomain = no\nreadme_directory = no\nsmtpd_use_tls=yes\nsmtpd_tls_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem\nsmtpd_tls_key_file=/etc/ssl/private/ssl-cert-snakeoil.key\nsmtpd_tls_security_level=may\nsmtp_tls_CApath=/etc/ssl/certs\nsmtp_use_tls=yes\nsmtp_tls_security_level=may\nsmtpd_relay_restrictions = permit_mynetworks permit_sasl_authenticated defer_unauth_destination\nmyhostname = legacy-unix-server.local\nalias_maps = hash:/etc/aliases\nalias_database = hash:/etc/aliases\nmyorigin = /etc/mailname\nmydestination = $myhostname, legacy-unix-server.local, localhost.local, localhost\nrelayhost = \nmynetworks = 127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128 192.168.1.0/24\nmailbox_size_limit = 0\nrecipient_delimiter = +\ninet_interfaces = all\ninet_protocols = all\nsmtpd_sasl_auth_enable = yes\nsmtpd_sasl_type = dovecot\nsmtpd_sasl_path = private/auth\nsmtpd_sasl_security_options = noanonymous\nsmtpd_recipient_restrictions = permit_mynetworks,permit_sasl_authenticated,reject_unauth_destination\n"
        },
        {
          "name": "dovecot.conf",
          "path": "/etc/dovecot",
          "content": "protocols = imap pop3\nmail_location = mbox:~/mail:INBOX=/var/mail/%u\nnamespace inbox {\n  inbox = yes\n}\nauth_mechanisms = plain login\npassdb {\n  driver = pam\n}\nuserdb {\n  driver = passwd\n}\nservice auth {\n  unix_listener /var/spool/postfix/private/auth {\n    mode = 0666\n    user = postfix\n    group = postfix\n  }\n}\nssl = no\nservice imap-login {\n  inet_listener imap {\n    port = 143\n  }\n}\nservice pop3-login {\n  inet_listener pop3 {\n    port = 110\n  }\n}\nlog_path = /var/log/dovecot.log\ninfo_log_path = /var/log/dovecot-info.log\ndebug_log_path = /var/log/dovecot-debug.log\n"
        },
        {
          "name": "passwd",
          "path": "/etc",
          "content": "root:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\nsync:x:4:65534:sync:/bin:/bin/sync\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\nirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin\ngnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\nsshd:x:100:65534::/var/run/sshd:/usr/sbin/nologin\ndevops:x:1001:1001:DevOps User:/home/devops:/bin/bash\nlegacy:x:1002:1002:Legacy System User:/home/legacy:/bin/bash\nguest:x:1003:1003:Guest Account:/tmp:/bin/bash\nservice:x:1004:1004:Service Account:/opt/services:/bin/bash\n"
        },
        {
          "name": "shadow",
          "path": "/etc",
          "content": "root:$6$rounds=4096$saltsalt$5wlQK.nYZeWz5rqyK0YjMx7OjYnAq7OpnFq.L5w8sP9fGmVv/3PzYqfhfkGpvGx1fCxgJ8dQvnz2fHqzK9lL61:19000:0:99999:7:::\ndaemon:*:19000:0:99999:7:::\nbin:*:19000:0:99999:7:::\nsys:*:19000:0:99999:7:::\nsync:*:19000:0:99999:7:::\ngames:*:19000:0:99999:7:::\nman:*:19000:0:99999:7:::\nlp:*:19000:0:99999:7:::\nmail:*:19000:0:99999:7:::\nnews:*:19000:0:99999:7:::\nuucp:*:19000:0:99999:7:::\nproxy:*:19000:0:99999:7:::\nwww-data:*:19000:0:99999:7:::\nbackup:*:19000:0:99999:7:::\nlist:*:19000:0:99999:7:::\nirc:*:19000:0:99999:7:::\ngnats:*:19000:0:99999:7:::\nnobody:*:19000:0:99999:7:::\nsshd:*:19000:0:99999:7:::\ndevops:$6$rounds=4096$devsalt$mKq4YzT8pLfwx.9yHgJ2nX4MpQa7vF5bGhW3eR1oP8sU6tL9cV2xS5mN7qA3bH1gF4kJ6eD8rT2yP9zC1mL0xW:19000:0:99999:7:::\nlegacy:$1$legacy$rJ2fP8qY6mT4nH3gL1sK9.:19000:0:99999:7:::\nguest::19000:0:99999:7:::\nservice:$6$service$nP5qR7sT1uV8wX2yZ4aB6cD9eF3gH7iJ0kL4mN8oP2qR5sT8uV1wX4yZ7aB0cD3eF6gH9iJ2kL5mN8oP1qR4sT7u:19000:0:99999:7:::\n"
        },
        {
          "name": "flag.txt",
          "path": "/var/backups",
          "content": "CTF{nfs_3xp0rts_r00t_squ4sh_g0n3_wr0ng}\n\nCongratulations! You successfully exploited the NFS misconfiguration.\n\nThe vulnerability was:\n- NFS export with no_root_squash allowing root access\n- World-readable/writable exports (*)\n- Sensitive backup directory exposed via NFS\n\nThis demonstrates why proper NFS security is critical:\n1. Avoid no_root_squash unless absolutely necessary\n2. Restrict exports to specific networks/hosts\n3. Never export sensitive directories\n4. Use proper authentication mechanisms\n"
        },
        {
          "name": "system_backup.tar.gz",
          "path": "/var/backups",
          "content": "# This would be a compressed archive containing:\n# - Configuration files\n# - User data\n# - Application secrets\n# - Database dumps\n# Generate with: tar -czf system_backup.tar.gz /etc/passwd /etc/shadow /opt/legacy_apps/config.xml"
        },
        {
          "name": "config.xml",
          "path": "/opt/legacy_apps",
          "content": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<configuration>\n  <database>\n    <host>localhost</host>\n    <port>3306</port>\n    <username>legacy_app</username>\n    <password>l3g4cy_p4ssw0rd_2023</password>\n    <database>legacy_system</database>\n  </database>\n  <api>\n    <key>sk_live_abc123def456ghi789jkl012</key>\n    <endpoint>https://api.legacy-system.internal</endpoint>\n  </api>\n  <admin>\n    <username>sysadmin</username>\n    <password_hash>5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8</password_hash>\n  </admin>\n  <debug>true</debug>\n</configuration>\n"
        },
        {
          "name": "network_scan.py",
          "path": "",
          "content": "#!/usr/bin/env python3\n\"\"\"\nNetwork Discovery Challenge - Solution Helper\nThis script demonstrates proper nmap usage for the challenge\n\"\"\"\n\nimport subprocess\nimport sys\n\ndef run_nmap_scan(target):\n    print(f\"[+] Starting comprehensive scan of {target}\")\n    \n    # Basic port scan\n    print(\"\\n[*] Phase 1: Port Discovery\")\n    cmd1 = f\"nmap -sS -O -sV --version-intensity 5 -p- {target}\"\n    print(f\"Command: {cmd1}\")\n    \n    # Service enumeration\n    print(\"\\n[*] Phase 2: Service Enumeration\")\n    cmd2 = f\"nmap -sC -sV -p 20,21,22,23,25,79,110,111,143,513,514,2049 {target}\"\n    print(f\"Command: {cmd2}\")\n    \n    # NFS specific enumeration\n    print(\"\\n[*] Phase 3: NFS Enumeration\")\n    cmd3 = f\"nmap --script nfs-ls,nfs-showmount,nfs-statfs -p 111,2049 {target}\"\n    print(f\"Command: {cmd3}\")\n    \n    # Showmount command\n    print(\"\\n[*] Phase 4: NFS Share Discovery\")\n    cmd4 = f\"showmount -e {target}\"\n    print(f\"Command: {cmd4}\")\n    \n    # Mount and access\n    print(\"\\n[*] Phase 5: Mount NFS Share\")\n    print(f\"mkdir /tmp/nfs_mount\")\n    print(f\"mount -t nfs {target}:/var/backups /tmp/nfs_mount\")\n    print(f\"ls -la /tmp/nfs_mount\")\n    print(f\"cat /tmp/nfs_mount/flag.txt\")\n\nif __name__ == \"__main__\":\n    if len(sys.argv) != 2:\n        print(\"Usage: python3 network_scan.py <target_ip>\")\n        sys.exit(1)\n    \n    target = sys.argv[1]\n    run_nmap_scan(target)\n"
        }
      ],
      "configurations": {
        "network": {
          "serviceType": "nfs",
          "misconfiguration": "NFS exports configured with no_root_squash and world-readable access, exposing sensitive backup directory with flag",
          "exploitPath": "1. Scan for NFS service (port 111, 2049) 2. Enumerate NFS exports with showmount -e 3. Mount /var/backups share 4. Access flag.txt as root due to no_root_squash",
          "tools": [
            "nmap",
            "showmount",
            "mount",
            "rpcinfo"
          ],
          "servicePort": 2049,
          "setup": "apt-get update && apt-get install -y nfs-kernel-server rpcbind xinetd telnetd finger postfix dovecot-core dovecot-imapd dovecot-pop3d openssh-server vsftpd && systemctl enable nfs-kernel-server rpcbind xinetd postfix dovecot ssh vsftpd && exportfs -ra && systemctl restart nfs-kernel-server rpcbind xinetd postfix dovecot ssh vsftpd",
          "difficulty": "medium",
          "hints": [],
          "learningObjectives": []
        }
      },
      "flag": "CTF{nfs_3xp0rts_r00t_squ4sh_g0n3_wr0ng}"
    },
    "windows-domain-controller": {
      "name": "windows-domain-controller",
      "type": "victim",
      "role": "Windows Server acting as domain controller with SMB and RPC services",
      "services": [
        "smb",
        "rpc",
        "ldap",
        "kerberos",
        "dns",
        "netbios",
        "rdp"
      ],
      "files": [
        {
          "name": "smb.conf",
          "path": "/etc/samba",
          "content": "[global]\n   workgroup = CORPNET\n   server string = Windows Domain Controller\n   netbios name = WIN-DC01\n   security = user\n   map to guest = bad user\n   dns proxy = no\n   log file = /var/log/samba/log.%m\n   max log size = 1000\n   server role = standalone server\n   passdb backend = tdbsam\n   obey pam restrictions = yes\n   unix password sync = yes\n   passwd program = /usr/bin/passwd %u\n   passwd chat = *Enter\\snew\\s*\\spassword:* %n\\n *Retype\\snew\\s*\\spassword:* %n\\n *password\\supdated\\ssuccessfully* .\n   pam password change = yes\n   map archive = no\n   map hidden = no\n   map read only = no\n   map system = no\n   store dos attributes = yes\n\n[public_access]\n   comment = Public Access Point\n   path = /srv/samba/public\n   browseable = yes\n   writable = yes\n   guest ok = yes\n   read only = no\n   create mask = 0755\n   directory mask = 0755\n   force user = root\n   force group = root\n   admin users = guest\n   valid users = @users, guest\n   write list = @users, guest\n\n[corporate_files]\n   comment = Corporate Document Repository\n   path = /srv/samba/corporate\n   browseable = yes\n   writable = no\n   guest ok = no\n   read only = yes\n   valid users = @domain_users\n   admin users = administrator\n\n[backup_scripts]\n   comment = Administrative Backup Scripts\n   path = /srv/samba/scripts\n   browseable = no\n   writable = yes\n   guest ok = no\n   read only = no\n   valid users = backup_user\n   admin users = backup_user\n   force user = root\n   create mask = 0777\n   directory mask = 0777"
        },
        {
          "name": "privilege_escalation.sh",
          "path": "/srv/samba/public",
          "content": "#!/bin/bash\n# Network Discovery Privilege Escalation Script\n# This script demonstrates SMB misconfiguration exploitation\n\necho \"[*] Starting privilege escalation enumeration...\"\necho \"[*] Target: Windows Domain Controller (SMB Service)\"\necho \"[*] Misconfiguration: Guest access with root privileges\"\n\n# Flag embedded in script comments\n# CTF{smb_guest_root_privilege_escalation_2024}\n\necho \"[+] Checking current user privileges...\"\nwhoami\nid\n\necho \"[+] Enumerating writable directories...\"\nfind /srv/samba -type d -writable 2>/dev/null\n\necho \"[+] Checking for SUID binaries...\"\nfind /srv/samba -perm -4000 2>/dev/null\n\necho \"[+] Network configuration discovery...\"\nifconfig 2>/dev/null || ip addr show\n\necho \"[+] Process enumeration...\"\nps aux | grep -E '(smbd|nmbd|winbind)'\n\necho \"[*] Privilege escalation vector identified:\"\necho \"    - SMB share 'public_access' allows guest write access\"\necho \"    - Force user/group set to root in smb.conf\"\necho \"    - Files created inherit root ownership\"\necho \"    - Admin users include guest account\"\n\necho \"[!] Exploitation complete. Flag location: embedded in script comments\""
        },
        {
          "name": "network_scan.txt",
          "path": "/srv/samba/corporate",
          "content": "NETWORK DISCOVERY LAB - SCAN RESULTS\n=====================================\n\nTarget Network: 192.168.100.0/24\nScan Date: 2024-01-15\nScanner: Nmap 7.94\n\nDISCOVERED HOSTS:\n-----------------\n192.168.100.10 - Windows Domain Controller (WIN-DC01)\n  - Port 20/tcp  - Custom SMB Service (filtered)\n  - Port 53/tcp  - DNS Service\n  - Port 88/tcp  - Kerberos\n  - Port 135/tcp - RPC Endpoint Mapper\n  - Port 139/tcp - NetBIOS Session Service\n  - Port 389/tcp - LDAP\n  - Port 445/tcp - Microsoft-DS (SMB)\n  - Port 3389/tcp - Remote Desktop Protocol\n\n192.168.100.20 - Unix Legacy Server\n  - Port 21/tcp  - FTP\n  - Port 22/tcp  - SSH\n  - Port 23/tcp  - Telnet\n  - Port 80/tcp  - HTTP\n\n192.168.100.30 - IoT Device\n  - Port 80/tcp  - HTTP (embedded web interface)\n  - Port 8080/tcp - Alternative HTTP\n\n192.168.100.40 - Honeypot System\n  - Port 22/tcp  - SSH (tarpit)\n  - Port 80/tcp  - HTTP (deception service)\n  - Port 443/tcp - HTTPS (certificate trap)\n\nOS FINGERPRINTING RESULTS:\n--------------------------\nWIN-DC01: Windows Server 2019 (99% confidence)\nUnix Server: Ubuntu 20.04 LTS (95% confidence)\nIoT Device: Linux 3.x embedded (87% confidence)\nHoneypot: Custom OS signature (stealth configuration)\n\nSCANNING TECHNIQUES USED:\n------------------------\n- TCP SYN Scan (-sS)\n- OS Detection (-O)\n- Service Version Detection (-sV)\n- Script Scanning (-sC)\n- Timing Template T4 (-T4)\n- Fragment Packets (-f)\n- Decoy Scanning (-D)\n\nRECOMMENDATIONS:\n---------------\n1. Investigate custom SMB service on port 20\n2. Enumerate domain controller services\n3. Test for anonymous access on shares\n4. Verify honeypot detection capabilities\n5. Assess IoT device security posture"
        },
        {
          "name": "domain_users.txt",
          "path": "/srv/samba/corporate",
          "content": "DOMAIN USERS - CORPNET DOMAIN\n==============================\n\nAdministrative Accounts:\n- administrator (Domain Admin)\n- backup_user (Backup Operators)\n- service_account (Service Account)\n\nStandard Users:\n- john.smith (Marketing)\n- sarah.jones (Finance) \n- mike.wilson (IT Support)\n- lisa.brown (HR)\n- david.clark (Sales)\n\nService Accounts:\n- sql_service (Database Service)\n- web_service (Web Application)\n- backup_service (Automated Backups)\n\nGuest Accounts:\n- guest (Default Guest Account - ENABLED)\n- temp_user (Temporary Access)\n\nDISABLED ACCOUNTS:\n- old_admin (Former Administrator)\n- contractor1 (Expired Contract)\n- test_user (Development Testing)\n\nPASSWORD POLICY:\n- Minimum Length: 8 characters\n- Complexity: Enabled\n- Maximum Age: 90 days\n- Account Lockout: 5 failed attempts\n- Lockout Duration: 30 minutes\n\nSECURITY GROUPS:\n- Domain Admins\n- Enterprise Admins\n- Backup Operators\n- Server Operators\n- Account Operators\n- Print Operators\n- Domain Users\n\nNOTE: Guest account has been inadvertently granted\nadministrative privileges on SMB shares due to\nmisconfigured force user settings."
        },
        {
          "name": "nmap_commands.txt",
          "path": "/srv/samba/scripts",
          "content": "NETWORK DISCOVERY LAB - NMAP COMMAND REFERENCE\n===============================================\n\nBASIC DISCOVERY:\n----------------\n# Host discovery\nnmap -sn 192.168.100.0/24\n\n# Port scan with service detection\nnmap -sS -sV -O 192.168.100.10\n\n# Comprehensive scan\nnmap -A -T4 192.168.100.10\n\nSMB ENUMERATION:\n----------------\n# SMB share enumeration\nnmap --script smb-enum-shares -p 445 192.168.100.10\n\n# SMB vulnerability scan\nnmap --script smb-vuln-* -p 445 192.168.100.10\n\n# Custom SMB port scan\nnmap -p 20 --script smb-enum-shares 192.168.100.10\n\nADVANCED TECHNIQUES:\n-------------------\n# Stealth scan with fragmentation\nnmap -sS -f -T2 192.168.100.10\n\n# Decoy scanning\nnmap -D 192.168.100.5,192.168.100.15 192.168.100.10\n\n# Source port spoofing\nnmap --source-port 53 192.168.100.10\n\n# Idle scan (zombie host)\nnmap -sI 192.168.100.20 192.168.100.10\n\nHONEYPOT EVASION:\n-----------------\n# Slow scan to avoid detection\nnmap -T1 --max-retries 1 192.168.100.40\n\n# Random target order\nnmap --randomize-hosts 192.168.100.30-40\n\n# Custom timing\nnmap --scan-delay 5s --max-scan-delay 10s 192.168.100.40\n\nSCRIPT CATEGORIES:\n------------------\n# Safe scripts only\nnmap --script safe 192.168.100.10\n\n# Authentication scripts\nnmap --script auth 192.168.100.10\n\n# Vulnerability detection\nnmap --script vuln 192.168.100.10\n\n# Default scripts\nnmap -sC 192.168.100.10\n\nOS DETECTION:\n-------------\n# Aggressive OS detection\nnmap -O --osscan-guess 192.168.100.0/24\n\n# OS fingerprinting with version detection\nnmap -sV -O --version-intensity 9 192.168.100.10\n\nOUTPUT FORMATS:\n---------------\n# XML output\nnmap -oX scan_results.xml 192.168.100.0/24\n\n# Grepable output\nnmap -oG scan_results.gnmap 192.168.100.0/24\n\n# All formats\nnmap -oA complete_scan 192.168.100.0/24"
        },
        {
          "name": "flag.txt",
          "path": "/srv/samba/public",
          "content": "CTF{smb_guest_root_privilege_escalation_2024}\n\nCongratulations! You've successfully identified and exploited\nthe SMB misconfiguration on the Windows Domain Controller.\n\nVULNERABILITY SUMMARY:\n======================\nService: SMB (Samba) on custom port 20\nMisconfiguration: Guest account with root privileges\nImpact: Privilege escalation from guest to root access\n\nEXPLOIT PATH:\n=============\n1. Network discovery using nmap\n2. SMB service enumeration on custom port 20\n3. Anonymous/guest access to public_access share\n4. Identification of force user = root configuration\n5. File upload with root ownership privileges\n6. Privilege escalation through misconfigured admin users\n\nLEARNING OBJECTIVES ACHIEVED:\n=============================\n✓ Network reconnaissance and port scanning\n✓ Service enumeration and version detection\n✓ SMB protocol analysis and exploitation\n✓ Privilege escalation techniques\n✓ OS fingerprinting and service identification\n✓ Custom port service discovery\n\nREMEDIATION:\n============\n- Remove guest from admin users list\n- Set appropriate force user (not root)\n- Disable guest access to sensitive shares\n- Implement proper access controls\n- Regular security audits of SMB configurations\n- Monitor for unusual privilege escalations"
        }
      ],
      "configurations": {
        "network": {
          "serviceType": "smb",
          "misconfiguration": "SMB share configured with guest access having root privileges through force user and admin users settings",
          "exploitPath": "1. Scan custom port 20 for SMB service 2. Enumerate SMB shares with anonymous access 3. Access public_access share as guest 4. Exploit force user = root configuration 5. Leverage admin users = guest for privilege escalation 6. Read flag from accessible files",
          "tools": [
            "nmap",
            "smbclient",
            "enum4linux",
            "rpcclient"
          ],
          "servicePort": 20,
          "setup": "apt update && apt install -y samba samba-common-bin && systemctl enable smbd && mkdir -p /srv/samba/{public,corporate,scripts} && chown -R root:root /srv/samba && chmod -R 755 /srv/samba && cp smb.conf /etc/samba/ && systemctl restart smbd && netstat -tlnp | grep :20",
          "difficulty": "medium",
          "hints": [],
          "learningObjectives": []
        }
      },
      "flag": "CTF{smb_guest_root_privilege_escalation_2024}"
    },
    "embedded-iot-gateway": {
      "name": "embedded-iot-gateway",
      "type": "victim",
      "role": "IoT gateway device with custom embedded services and unusual ports",
      "services": [
        "http",
        "https",
        "snmp",
        "tftp",
        "custom-9999",
        "custom-8765",
        "upnp"
      ],
      "files": [
        {
          "name": "httpd.conf",
          "path": "/etc/apache2/sites-available",
          "content": "ServerRoot \"/etc/apache2\"\nListen 80\nListen 443 ssl\nServerName embedded-iot-gateway.local\n\nLoadModule rewrite_module modules/mod_rewrite.so\nLoadModule ssl_module modules/mod_ssl.so\nLoadModule status_module modules/mod_status.so\n\n<Directory \"/var/www/html\">\n    Options Indexes FollowSymLinks\n    AllowOverride All\n    Require all granted\n</Directory>\n\n<VirtualHost *:80>\n    DocumentRoot \"/var/www/html\"\n    ServerName embedded-iot-gateway.local\n    \n    <Location \"/server-status\">\n        SetHandler server-status\n        Require all granted\n    </Location>\n    \n    <Location \"/device-info\">\n        SetHandler server-info\n        Require all granted\n    </Location>\nErrorLog logs/error.log\nCustomLog logs/access.log combined\n</VirtualHost>\n\n<VirtualHost *:443>\n    DocumentRoot \"/var/www/html\"\n    ServerName embedded-iot-gateway.local\n    SSLEngine on\n    SSLCertificateFile /etc/ssl/certs/gateway.crt\n    SSLCertificateKeyFile /etc/ssl/private/gateway.key\n    SSLProtocol all -SSLv2 -SSLv3\n</VirtualHost>"
        },
        {
          "name": "snmpd.conf",
          "path": "/etc/snmp",
          "content": "agentAddress udp:161,udp6:[::1]:161\n\nrocommunity public default\nrocommunity private 192.168.1.0/24\nrwcommunity admin 127.0.0.1\n\nsysLocation Gateway Control Room\nsysContact admin@iotgateway.local\nsysDescr Embedded IoT Gateway v2.1.4\nsysName embedded-iot-gateway\n\n# Custom OID for device management\nextend .1.3.6.1.4.1.2021.10.1.3.1 device-status /usr/local/bin/device-check.sh\nextend .1.3.6.1.4.1.2021.10.1.3.2 flag-reader /usr/local/bin/flag-service.sh\n\n# Enable SNMP traps\ntrapsink 192.168.1.100 public\n\n# Disable SNMP v1/v2 security\ndefaultMonitors yes\nlinkUpDownNotifications yes\n\n# Allow full MIB access\nview systemonly included .1.3.6.1.2.1.1\nview systemonly included .1.3.6.1.2.1.25.1\nview all included .1 80\n\nrocommunity public default -V systemonly\nrocommunity gateway 192.168.1.0/24 -V all"
        },
        {
          "name": "tftpd.conf",
          "path": "/etc/xinetd.d",
          "content": "service tftp\n{\n    protocol = udp\n    port = 69\n    socket_type = dgram\n    wait = yes\n    user = nobody\n    server = /usr/sbin/in.tftpd\n    server_args = -s /tftpboot -c\n    disable = no\n    flags = IPv4\n    per_source = 11\n    cps = 100 2\n}"
        },
        {
          "name": "custom-service-9999.py",
          "path": "/usr/local/bin",
          "content": "#!/usr/bin/env python3\nimport socket\nimport threading\nimport base64\n\nBANNER = b\"IoT Gateway Management Protocol v1.2\\r\\n\"\nFLAG_PART = \"CTF{n3tw0rk_d1sc0v3ry_\"\n\ndef handle_client(conn, addr):\n    try:\n        conn.send(BANNER)\n        conn.send(b\"Commands: STATUS, INFO, CONFIG, DEBUG\\r\\n\")\n        \n        while True:\n            data = conn.recv(1024).decode().strip().upper()\n            if not data:\n                break\n                \n            if data == \"STATUS\":\n                conn.send(b\"System: ONLINE\\r\\nDevices: 24 connected\\r\\nUptime: 15 days\\r\\n\")\n            elif data == \"INFO\":\n                conn.send(b\"Model: EmbeddedGW-2000\\r\\nFirmware: 2.1.4-beta\\r\\nManufacturer: SecureIoT Corp\\r\\n\")\n            elif data == \"CONFIG\":\n                conn.send(b\"Access Level: GUEST\\r\\nFull config requires authentication\\r\\n\")\n            elif data == \"DEBUG\":\n                conn.send(f\"Debug Token: {base64.b64encode(FLAG_PART.encode()).decode()}\\r\\n\".encode())\n            elif data == \"QUIT\":\n                break\n            else:\n                conn.send(b\"Unknown command\\r\\n\")\n                \n    except Exception as e:\n        pass\n    finally:\n        conn.close()\n\ndef start_server():\n    server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n    server.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\n    server.bind(('0.0.0.0', 9999))\n    server.listen(5)\n    \n    while True:\n        conn, addr = server.accept()\n        thread = threading.Thread(target=handle_client, args=(conn, addr))\n        thread.start()\n\nif __name__ == '__main__':\n    start_server()"
        },
        {
          "name": "upnp-service.py",
          "path": "/usr/local/bin",
          "content": "#!/usr/bin/env python3\nimport socket\nimport threading\nfrom datetime import datetime\n\nUPNP_RESPONSE = '''HTTP/1.1 200 OK\\r\nCACHE-CONTROL: max-age=1800\\r\nDATE: {}\\r\nEXT:\\r\nLOCATION: http://192.168.1.50:8765/device.xml\\r\nOPT: \"http://schemas.upnp.org/upnp/1/0/\"; ns=01\\r\n01-NLS: 1\\r\nSERVER: Linux/3.14 UPnP/1.0 EmbeddedGW/2.1\\r\nST: upnp:rootdevice\\r\nUSN: uuid:12345678-1234-1234-1234-123456789abc::upnp:rootdevice\\r\nBOOTID.UPNP.ORG: 1\\r\nCONFIGID.UPNP.ORG: 2\\r\n\\r\n'''\n\ndef handle_upnp_discovery():\n    sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\n    sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\n    sock.bind(('', 1900))\n    \n    mreq = socket.inet_aton('239.255.255.250') + socket.inet_aton('0.0.0.0')\n    sock.setsockopt(socket.IPPROTO_IP, socket.IP_ADD_MEMBERSHIP, mreq)\n    \n    while True:\n        try:\n            data, addr = sock.recvfrom(1024)\n            if b'M-SEARCH' in data and b'upnp:rootdevice' in data:\n                response = UPNP_RESPONSE.format(datetime.now().strftime('%a, %d %b %Y %H:%M:%S GMT'))\n                response_sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\n                response_sock.sendto(response.encode(), addr)\n                response_sock.close()\n        except Exception as e:\n            continue\n\ndef handle_device_xml():\n    server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n    server.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\n    server.bind(('0.0.0.0', 8765))\n    server.listen(5)\n    \n    device_xml = '''HTTP/1.1 200 OK\\r\nContent-Type: text/xml\\r\nContent-Length: 891\\r\n\\r\n<?xml version=\"1.0\"?>\\r\n<root xmlns=\"urn:schemas-upnp-org:device-1-0\">\\r\n<specVersion><major>1</major><minor>0</minor></specVersion>\\r\n<device>\\r\n<deviceType>urn:schemas-upnp-org:device:InternetGatewayDevice:1</deviceType>\\r\n<friendlyName>Embedded IoT Gateway</friendlyName>\\r\n<manufacturer>SecureIoT Corp</manufacturer>\\r\n<modelDescription>Multi-protocol IoT Gateway</modelDescription>\\r\n<modelName>EmbeddedGW-2000</modelName>\\r\n<modelNumber>2.1.4</modelNumber>\\r\n<serialNumber>EGW-20231201-7845</serialNumber>\\r\n<UDN>uuid:12345678-1234-1234-1234-123456789abc</UDN>\\r\n<serviceList>\\r\n<service>\\r\n<serviceType>urn:schemas-upnp-org:service:DeviceManagement:1</serviceType>\\r\n<serviceId>urn:upnp-org:serviceId:DevMgmt</serviceId>\\r\n<SCPDURL>/management.xml</SCPDURL>\\r\n<controlURL>/control</controlURL>\\r\n</service>\\r\n</serviceList>\\r\n<!-- Flag suffix: bY5t3r_m4st3r} -->\\r\n</device>\\r\n</root>\\r\n'''\n    \n    while True:\n        conn, addr = server.accept()\n        try:\n            data = conn.recv(1024)\n            if b'GET /device.xml' in data:\n                conn.send(device_xml.encode())\n            elif b'GET /management.xml' in data:\n                mgmt_response = '''HTTP/1.1 200 OK\\r\nContent-Type: text/xml\\r\n\\r\n<?xml version=\"1.0\"?>\\r\n<scpd xmlns=\"urn:schemas-upnp-org:service-1-0\">\\r\n<specVersion><major>1</major><minor>0</minor></specVersion>\\r\n<actionList>\\r\n<action><name>GetDeviceInfo</name></action>\\r\n<action><name>Reboot</name></action>\\r\n</actionList>\\r\n</scpd>\\r\n'''\n                conn.send(mgmt_response.encode())\n            else:\n                conn.send(b'HTTP/1.1 404 Not Found\\r\\n\\r\\n')\n        except:\n            pass\n        finally:\n            conn.close()\n\nif __name__ == '__main__':\n    upnp_thread = threading.Thread(target=handle_upnp_discovery)\n    xml_thread = threading.Thread(target=handle_device_xml)\n    \n    upnp_thread.daemon = True\n    xml_thread.daemon = True\n    \n    upnp_thread.start()\n    xml_thread.start()\n    \n    upnp_thread.join()\n    xml_thread.join()"
        },
        {
          "name": "index.html",
          "path": "/var/www/html",
          "content": "<!DOCTYPE html>\n<html>\n<head>\n    <title>Embedded IoT Gateway - Management Interface</title>\n    <meta name=\"generator\" content=\"EmbeddedGW WebUI 2.1.4\">\n    <style>\n        body { font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }\n        .header { background: #2c3e50; color: white; padding: 20px; border-radius: 5px; }\n        .content { background: white; padding: 20px; margin-top: 20px; border-radius: 5px; }\n        .status { color: #27ae60; font-weight: bold; }\n        .warning { color: #e74c3c; font-size: 0.9em; }\n    </style>\n</head>\n<body>\n    <div class=\"header\">\n        <h1>Embedded IoT Gateway</h1>\n        <p>Model: EmbeddedGW-2000 | Firmware: 2.1.4-beta | Uptime: 15 days, 7 hours</p>\n    </div>\n    \n    <div class=\"content\">\n        <h2>System Status</h2>\n        <p class=\"status\">✓ Gateway: ONLINE</p>\n        <p class=\"status\">✓ Connected Devices: 24</p>\n        <p class=\"status\">✓ Network Interfaces: 3 active</p>\n        \n        <h3>Quick Links</h3>\n        <ul>\n            <li><a href=\"/device-info\">Device Information</a></li>\n            <li><a href=\"/server-status\">Server Status</a></li>\n            <li><a href=\"/config\">Configuration (Admin Only)</a></li>\n        </ul>\n        \n        <h3>Network Services</h3>\n        <p>Multiple protocols supported for device management and monitoring.</p>\n        <p class=\"warning\">Note: Some services may be running in development mode with relaxed security.</p>\n        \n        <hr>\n        <small>SecureIoT Corp &copy; 2024 | For support contact: admin@iotgateway.local</small>\n    </div>\n</body>\n</html>"
        },
        {
          "name": "device-check.sh",
          "path": "/usr/local/bin",
          "content": "#!/bin/bash\necho \"Gateway Status: OPERATIONAL\"\necho \"Temperature: 42C\"\necho \"Memory Usage: 67%\"\necho \"Network Interfaces: eth0(up), wlan0(up), zigbee0(up)\"\necho \"Connected Devices: 24\"\necho \"Last Update: $(date)\""
        },
        {
          "name": "flag-service.sh",
          "path": "/usr/local/bin",
          "content": "#!/bin/bash\n# SNMP-accessible flag service\necho \"Service Token: Q1RGe24zdHcwcmtfZDFzYzB2M3J5X2JZNXQzci1tNHN0M3J9\"\necho \"Decode method: base64\"\necho \"Usage: Administrative access only\""
        },
        {
          "name": "config",
          "path": "/var/www/html",
          "content": "<!DOCTYPE html>\n<html>\n<head>\n    <title>Configuration - Access Denied</title>\n</head>\n<body>\n    <h1>403 - Forbidden</h1>\n    <p>Administrative access required.</p>\n    <p>Hint: Try alternative management protocols for device enumeration.</p>\n    <small>Error Code: CFG-401-UNAUTH</small>\n</body>\n</html>"
        },
        {
          "name": "firmware.bin",
          "path": "/tftpboot",
          "content": "FIRMWARE_HEADER_V2.1.4\nManufacturer: SecureIoT Corp\nModel: EmbeddedGW-2000\nBuild Date: 2024-01-15\nChecksum: a7f5c8d9e2b1f4a6\n\n# Configuration snippet embedded in firmware\n# Default credentials (development build)\n# Username: admin\n# Password: gateway123\n# \n# SNMP Community Strings:\n# Read: public, gateway\n# Write: admin (localhost only)\n#\n# Custom Protocol Tokens:\n# Management Port 9999: DEBUG command reveals encoded flag portion\n# UPnP Device XML: Contains flag suffix in comments\n#\n# Flag Assembly Instructions:\n# 1. Base64 decode token from port 9999 DEBUG command\n# 2. Extract suffix from UPnP device XML comment\n# 3. Combine: [decoded_prefix][suffix]\n#\n# Security Note: This is a development firmware with debug features enabled\n# Production deployment should disable TFTP, SNMP write access, and debug tokens\n\n[BINARY_DATA_PLACEHOLDER_4KB]"
        },
        {
          "name": "startup.sh",
          "path": "/usr/local/bin",
          "content": "#!/bin/bash\n# Embedded IoT Gateway Startup Script\n\necho \"Starting Embedded IoT Gateway Services...\"\n\n# Start Apache web server\nsudo systemctl start apache2\necho \"✓ HTTP/HTTPS services started\"\n\n# Start SNMP daemon\nsudo systemctl start snmpd\necho \"✓ SNMP service started\"\n\n# Start TFTP server\nsudo systemctl start xinetd\necho \"✓ TFTP service started\"\n\n# Start custom management service\npython3 /usr/local/bin/custom-service-9999.py &\necho \"✓ Custom management protocol (port 9999) started\"\n\n# Start UPnP service\npython3 /usr/local/bin/upnp-service.py &\necho \"✓ UPnP discovery service started\"\n\n# Make scripts executable\nchmod +x /usr/local/bin/device-check.sh\nchmod +x /usr/local/bin/flag-service.sh\n\necho \"All services started successfully!\"\necho \"Gateway ready for network discovery and enumeration practice.\""
        }
      ],
      "configurations": {
        "network": {
          "serviceType": "multi-service",
          "misconfiguration": "Multiple services with information disclosure vulnerabilities including SNMP with weak community strings, TFTP with sensitive files, custom protocol with debug tokens, and UPnP with embedded flag data",
          "exploitPath": "1. Perform comprehensive nmap scan to discover all services (80, 443, 161, 69, 9999, 8765, 1900). 2. Enumerate HTTP for basic info and accessible endpoints. 3. Query SNMP with community string 'gateway' to access extended OIDs and flag service. 4. Connect to custom service on port 9999, use DEBUG command to get base64 encoded flag prefix. 5. Perform UPnP discovery to find device XML endpoint on port 8765, extract flag suffix from XML comment. 6. Decode base64 token and combine with suffix to get complete flag. 7. Optional: Access TFTP to download firmware.bin for additional reconnaissance data.",
          "tools": [
            "nmap",
            "snmpwalk",
            "curl",
            "nc",
            "base64",
            "tftp"
          ],
          "servicePort": "80,443,161,69,9999,8765,1900",
          "setup": "sudo chmod +x /usr/local/bin/*.sh && sudo chmod +x /usr/local/bin/*.py && sudo /usr/local/bin/startup.sh",
          "difficulty": "medium",
          "hints": [],
          "learningObjectives": []
        }
      },
      "flag": "CTF{n3tw0rk_d1sc0v3ry_bY5t3r_m4st3r}"
    },
    "stealth-honeypot": {
      "name": "stealth-honeypot",
      "type": "victim",
      "role": "Stealth system designed to test advanced nmap evasion and timing techniques",
      "services": [
        "ssh",
        "http",
        "mysql",
        "postgresql",
        "mongodb"
      ],
      "files": [
        {
          "name": "sshd_config",
          "path": "/etc/ssh",
          "content": "# SSH daemon configuration for stealth-honeypot\nPort 22\nProtocol 2\nHostKey /etc/ssh/ssh_host_rsa_key\nHostKey /etc/ssh/ssh_host_dsa_key\nHostKey /etc/ssh/ssh_host_ecdsa_key\nHostKey /etc/ssh/ssh_host_ed25519_key\nUsePrivilegeSeparation yes\nKeyRegenerationInterval 3600\nServerKeyBits 1024\nSyslogFacility AUTH\nLogLevel INFO\nLoginGraceTime 120\nPermitRootLogin yes\nStrictModes yes\nRSAAuthentication yes\nPubkeyAuthentication yes\nIgnoreRhosts yes\nRhostsRSAAuthentication no\nHostbasedAuthentication no\nPermitEmptyPasswords no\nChallengeResponseAuthentication no\nPasswordAuthentication yes\nX11Forwarding yes\nX11DisplayOffset 10\nPrintMotd no\nPrintLastLog yes\nTCPKeepAlive yes\nAcceptEnv LANG LC_*\nSubsystem sftp /usr/lib/openssh/sftp-server\nUsePAM yes\nAllowUsers scanner maintenance\nMatch User scanner\n    ForceCommand /usr/local/bin/restricted-shell\n    PasswordAuthentication yes\nMatch User maintenance\n    PasswordAuthentication yes\n    ChrootDirectory /var/chroot/maintenance"
        },
        {
          "name": "restricted-shell",
          "path": "/usr/local/bin",
          "content": "#!/bin/bash\n# Restricted shell for scanner user\nexport PATH=/usr/bin:/bin\nexport PS1=\"scanner@honeypot:~$ \"\n\necho \"Welcome to Network Discovery Lab - stealth-honeypot\"\necho \"Available commands: ls, cat, id, whoami, uname, netstat, ss\"\necho \"Type 'help' for more information\"\n\nwhile true; do\n    read -p \"scanner@honeypot:~$ \" cmd args\n    \n    case \"$cmd\" in\n        \"ls\")\n            if [ -z \"$args\" ]; then\n                echo \"discovery-notes.txt  system-info.log\"\n            else\n                echo \"Permission denied\"\n            fi\n            ;;\n        \"cat\")\n            if [ \"$args\" = \"discovery-notes.txt\" ]; then\n                echo \"Network Discovery Lab Notes:\"\n                echo \"- SSH service running on default port\"\n                echo \"- Multiple database services detected\"\n                echo \"- Web service configuration pending\"\n                echo \"- Maintenance account has elevated privileges\"\n                echo \"- Check /var/log/auth.log for access patterns\"\n            elif [ \"$args\" = \"system-info.log\" ]; then\n                echo \"System: Ubuntu 18.04.6 LTS\"\n                echo \"Kernel: Linux 4.15.0-142-generic\"\n                echo \"Services: SSH(22), HTTP(80), MySQL(3306), PostgreSQL(5432), MongoDB(27017)\"\n                echo \"Last maintenance: 2023-11-15 by maintenance user\"\n                echo \"Note: maintenance password follows company policy: maint_[hostname]_2023\"\n            else\n                echo \"File not found\"\n            fi\n            ;;\n        \"id\")\n            echo \"uid=1001(scanner) gid=1001(scanner) groups=1001(scanner)\"\n            ;;\n        \"whoami\")\n            echo \"scanner\"\n            ;;\n        \"uname\")\n            echo \"Linux stealth-honeypot 4.15.0-142-generic x86_64 GNU/Linux\"\n            ;;\n        \"netstat\")\n            echo \"Active Internet connections (only servers)\"\n            echo \"Proto Recv-Q Send-Q Local Address           Foreign Address         State\"\n            echo \"tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN\"\n            echo \"tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN\"\n            echo \"tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN\"\n            echo \"tcp        0      0 127.0.0.1:5432          0.0.0.0:*               LISTEN\"\n            echo \"tcp        0      0 127.0.0.1:27017         0.0.0.0:*               LISTEN\"\n            ;;\n        \"ss\")\n            echo \"Netid  State      Recv-Q Send-Q Local Address:Port               Peer Address:Port\"\n            echo \"tcp    LISTEN     0      128    *:22                           *:*\"\n            echo \"tcp    LISTEN     0      80     127.0.0.1:3306                 *:*\"\n            echo \"tcp    LISTEN     0      128    *:80                           *:*\"\n            echo \"tcp    LISTEN     0      128    127.0.0.1:5432                 *:*\"\n            echo \"tcp    LISTEN     0      128    127.0.0.1:27017                *:*\"\n            ;;\n        \"help\")\n            echo \"Restricted shell - Available commands:\"\n            echo \"ls       - List files in current directory\"\n            echo \"cat      - Display file contents (limited files)\"\n            echo \"id       - Show user ID\"\n            echo \"whoami   - Show current user\"\n            echo \"uname    - Show system information\"\n            echo \"netstat  - Show network connections\"\n            echo \"ss       - Show socket statistics\"\n            echo \"exit     - Disconnect\"\n            ;;\n        \"exit\")\n            echo \"Goodbye!\"\n            exit 0\n            ;;\n        *)\n            echo \"Command not allowed: $cmd\"\n            echo \"Type 'help' for available commands\"\n            ;;\n    esac\ndone"
        },
        {
          "name": "passwd",
          "path": "/etc",
          "content": "root:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\nsync:x:4:65534:sync:/bin:/bin/sync\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\nirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin\ngnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\nsystemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin\nsystemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin\nsyslog:x:102:106::/home/syslog:/usr/sbin/nologin\nmessagebus:x:103:107::/nonexistent:/usr/sbin/nologin\n_apt:x:104:65534::/nonexistent:/usr/sbin/nologin\nuuidd:x:105:109::/run/uuidd:/usr/sbin/nologin\navahi-autoipd:x:106:110:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/usr/sbin/nologin\nusbmux:x:107:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin\ndnsmasq:x:108:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin\nrtkit:x:109:114:RealtimeKit,,,:/proc:/usr/sbin/nologin\ncups-pk-helper:x:110:116:user for cups-pk-helper service,,,:/home/cups-pk-helper:/usr/sbin/nologin\nspeech-dispatcher:x:111:29:Speech Dispatcher,,,:/var/run/speech-dispatcher:/bin/false\nwhoopsie:x:112:117::/nonexistent:/bin/false\nkernoops:x:113:65534:Kernel Oops Tracking Daemon,,,:/:/usr/sbin/nologin\npulse:x:114:118:PulseAudio daemon,,,:/var/run/pulse:/usr/sbin/nologin\navahi:x:115:121:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/usr/sbin/nologin\ncolord:x:116:122:colord colour management daemon,,,:/var/lib/colord:/usr/sbin/nologin\nhplip:x:117:7:HPLIP system user,,,:/var/run/hplip:/bin/false\ngeoclue:x:118:123::/var/lib/geoclue:/usr/sbin/nologin\ngnome-initial-setup:x:119:65534::/run/gnome-initial-setup/:/bin/false\ngdm:x:120:125:Gnome Display Manager:/var/lib/gdm3:/bin/false\nscanner:x:1001:1001:Network Scanner User:/home/scanner:/usr/local/bin/restricted-shell\nmaintenance:x:1002:1002:System Maintenance:/var/chroot/maintenance:/bin/bash\nmysql:x:121:129:MySQL Server,,,:/nonexistent:/bin/false\npostgres:x:122:130:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash\nmongodb:x:123:131::/var/lib/mongodb:/usr/sbin/nologin\nsshd:x:124:65534::/run/sshd:/usr/sbin/nologin"
        },
        {
          "name": "shadow",
          "path": "/etc",
          "content": "root:$6$rounds=656000$YQKJzJGHDGfz4tGH$vt4hVVgmzLcWwT8.4K3Lf0K3Lf0K3Lf0K3Lf0K3Lf0K3Lf0K3Lf0K3Lf0K3Lf0K3Lf0K3Lf0:18918:0:99999:7:::\ndaemon:*:18474:0:99999:7:::\nbin:*:18474:0:99999:7:::\nsys:*:18474:0:99999:7:::\nsync:*:18474:0:99999:7:::\ngames:*:18474:0:99999:7:::\nman:*:18474:0:99999:7:::\nlp:*:18474:0:99999:7:::\nmail:*:18474:0:99999:7:::\nnews:*:18474:0:99999:7:::\nuucp:*:18474:0:99999:7:::\nproxy:*:18474:0:99999:7:::\nwww-data:*:18474:0:99999:7:::\nbackup:*:18474:0:99999:7:::\nlist:*:18474:0:99999:7:::\nirc:*:18474:0:99999:7:::\ngnats:*:18474:0:99999:7:::\nnobody:*:18474:0:99999:7:::\nsystemd-network:*:18474:0:99999:7:::\nsystemd-resolve:*:18474:0:99999:7:::\nsyslog:*:18474:0:99999:7:::\nmessagebus:*:18474:0:99999:7:::\n_apt:*:18474:0:99999:7:::\nuuidd:*:18474:0:99999:7:::\navahi-autoipd:*:18474:0:99999:7:::\nusbmux:*:18474:0:99999:7:::\ndnsmasq:*:18474:0:99999:7:::\nrtkit:*:18474:0:99999:7:::\ncups-pk-helper:*:18474:0:99999:7:::\nspeech-dispatcher:!:18474:0:99999:7:::\nwhoopsie:*:18474:0:99999:7:::\nkernoops:*:18474:0:99999:7:::\npulse:*:18474:0:99999:7:::\navahi:*:18474:0:99999:7:::\ncolord:*:18474:0:99999:7:::\nhplip:*:18474:0:99999:7:::\ngeoclue:*:18474:0:99999:7:::\ngnome-initial-setup:*:18474:0:99999:7:::\ngdm:*:18474:0:99999:7:::\nscanner:$6$rounds=656000$salt123456789$K3.F5z9x7YwQ2mN8pL6rT4sU1vB9cD0eA2fG3hI4jK5lM6nO7pQ8rS9tU0vW1xY2zA3bC4dE5fG6hI7jK8lM9nO:18918:0:99999:7:::\nmaintenance:$6$rounds=656000$saltsalt1234$vt4hVVgmzLcWwT8pL6rT4sU1vB9cD0eA2fG3hI4jK5lM6nO7pQ8rS9tU0vW1xY2zA3bC4dE5fG6hI7jK8lM9nO:18918:0:99999:7:::\nmysql:!:18474:0:99999:7:::\npostgres:*:18474:0:99999:7:::\nmongodb:*:18474:0:99999:7:::\nsshd:*:18474:0:99999:7:::"
        },
        {
          "name": "flag.txt",
          "path": "/var/chroot/maintenance",
          "content": "CTF{n3tw0rk_d1sc0v3ry_m4st3r_2023_ssh_pr1v_3sc}"
        },
        {
          "name": "maintenance-notes.txt",
          "path": "/var/chroot/maintenance",
          "content": "MAINTENANCE LOG - stealth-honeypot\n=================================\n\nDate: 2023-11-15\nTechnician: maintenance user\n\nSystem Status:\n- All database services running on localhost only\n- SSH access restricted for scanner account\n- Web service pending configuration\n- Honeypot logging active\n\nSecurity Notes:\n- Scanner account has restricted shell access\n- Maintenance account has full system access\n- Password policy: maint_[hostname]_[year]\n- Flag stored in maintenance home directory\n\nTODO:\n- Update database bindings to external interfaces\n- Configure web service authentication\n- Review SSH key management\n\nNetwork Discovery Lab Flag: CTF{n3tw0rk_d1sc0v3ry_m4st3r_2023_ssh_pr1v_3sc}\n\nReminder: This system is part of the Multi-OS Network Discovery Lab\nObjective: Practice comprehensive nmap reconnaissance techniques"
        },
        {
          "name": "apache2.conf",
          "path": "/etc/apache2",
          "content": "# Apache2 configuration for stealth-honeypot\nDefaultRuntimeDir ${APACHE_RUN_DIR}\nPidFile ${APACHE_PID_FILE}\nTimeout 300\nKeepAlive On\nMaxKeepAliveRequests 100\nKeepAliveTimeout 5\nUser ${APACHE_RUN_USER}\nGroup ${APACHE_RUN_GROUP}\nHostnameLookups Off\nErrorLog ${APACHE_LOG_DIR}/error.log\nLogLevel warn\nIncludeOptional mods-enabled/*.load\nIncludeOptional mods-enabled/*.conf\nInclude ports.conf\n<Directory />\n    Options FollowSymLinks\n    AllowOverride None\n    Require all denied\n</Directory>\n<Directory /usr/share>\n    AllowOverride None\n    Require all granted\n</Directory>\n<Directory /var/www/>\n    Options Indexes FollowSymLinks\n    AllowOverride None\n    Require all granted\n</Directory>\nAccessFileName .htaccess\n<FilesMatch \"^\\.ht\">\n    Require all denied\n</FilesMatch>\nLogFormat \"%v:%p %h %l %u %t \\\"%r\\\" %>s %O \\\"%{Referer}i\\\" \\\"%{User-Agent}i\\\"\" vhost_combined\nLogFormat \"%h %l %u %t \\\"%r\\\" %>s %O \\\"%{Referer}i\\\" \\\"%{User-Agent}i\\\"\" combined\nLogFormat \"%h %l %u %t \\\"%r\\\" %>s %O\" common\nLogFormat \"%{Referer}i -> %U\" referer\nLogFormat \"%{User-agent}i\" agent\nIncludeOptional conf-enabled/*.conf\nIncludeOptional sites-enabled/*.conf\nListen 80\nServerName stealth-honeypot"
        },
        {
          "name": "index.html",
          "path": "/var/www/html",
          "content": "<!DOCTYPE html>\n<html>\n<head>\n    <title>Network Discovery Lab - stealth-honeypot</title>\n    <style>\n        body { font-family: Arial, sans-serif; margin: 40px; background-color: #f5f5f5; }\n        .container { max-width: 800px; margin: 0 auto; background-color: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }\n        h1 { color: #333; border-bottom: 2px solid #007acc; padding-bottom: 10px; }\n        .service-list { background-color: #f9f9f9; padding: 15px; border-radius: 5px; margin: 20px 0; }\n        .note { background-color: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 5px; margin: 20px 0; }\n        code { background-color: #e9ecef; padding: 2px 4px; border-radius: 3px; font-family: 'Courier New', monospace; }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <h1>Network Discovery Lab - stealth-honeypot</h1>\n        \n        <p>Welcome to the Multi-OS Network Discovery Environment. This honeypot system is designed to help you practice comprehensive network reconnaissance techniques.</p>\n        \n        <div class=\"service-list\">\n            <h3>Active Services:</h3>\n            <ul>\n                <li><strong>SSH (Port 22):</strong> Secure Shell - Multiple user accounts available</li>\n                <li><strong>HTTP (Port 80):</strong> Web Server - Basic information page</li>\n                <li><strong>MySQL (Port 3306):</strong> Database Server - Local binding only</li>\n                <li><strong>PostgreSQL (Port 5432):</strong> Database Server - Local binding only</li>\n                <li><strong>MongoDB (Port 27017):</strong> NoSQL Database - Local binding only</li>\n            </ul>\n        </div>\n        \n        <div class=\"note\">\n            <h3>Lab Objectives:</h3>\n            <p>Practice nmap's full capabilities including:</p>\n            <ul>\n                <li>OS detection and fingerprinting</li>\n                <li>Service enumeration and version detection</li>\n                <li>Timing attacks and stealth scanning</li>\n                <li>Evasion techniques for honeypot detection</li>\n            </ul>\n        </div>\n        \n        <h3>Getting Started:</h3>\n        <p>Begin your reconnaissance with a comprehensive nmap scan. Look for:</p>\n        <ul>\n            <li>Open ports and running services</li>\n            <li>Operating system identification</li>\n            <li>Service versions and potential vulnerabilities</li>\n            <li>Unusual service configurations</li>\n        </ul>\n        \n        <p><strong>Hint:</strong> Some services may require authentication. Check for common credentials or configuration hints in accessible services.</p>\n        \n        <p><em>System: Ubuntu 18.04.6 LTS | Hostname: stealth-honeypot | Lab Type: Multi-OS Discovery</em></p>\n    </div>\n</body>\n</html>"
        },
        {
          "name": "my.cnf",
          "path": "/etc/mysql",
          "content": "[client]\nport = 3306\nsocket = /var/run/mysqld/mysqld.sock\n\n[mysqld_safe]\nsocket = /var/run/mysqld/mysqld.sock\nnice = 0\n\n[mysqld]\nuser = mysql\npid-file = /var/run/mysqld/mysqld.pid\nsocket = /var/run/mysqld/mysqld.sock\nport = 3306\nbasedir = /usr\ndatadir = /var/lib/mysql\ntmpdir = /tmp\nlc-messages-dir = /usr/share/mysql\nskip-external-locking\nbind-address = 127.0.0.1\nkey_buffer_size = 16M\nmax_allowed_packet = 16M\nthread_stack = 192K\nthread_cache_size = 8\nmyisam-recover-options = BACKUP\nquery_cache_limit = 1M\nquery_cache_size = 16M\nlog_error = /var/log/mysql/error.log\nexpire_logs_days = 10\nmax_binlog_size = 100M\n\n[mysqldump]\nquick\nquote-names\nmax_allowed_packet = 16M\n\n[mysql]\n\n[isamchk]\nkey_buffer = 16M"
        },
        {
          "name": "postgresql.conf",
          "path": "/etc/postgresql/10/main",
          "content": "# PostgreSQL configuration for stealth-honeypot\ndata_directory = '/var/lib/postgresql/10/main'\nhba_file = '/etc/postgresql/10/main/pg_hba.conf'\nident_file = '/etc/postgresql/10/main/pg_ident.conf'\nexternal_pid_file = '/var/run/postgresql/10-main.pid'\nlisten_addresses = 'localhost'\nport = 5432\nmax_connections = 100\nunix_socket_directories = '/var/run/postgresql'\nssl = on\nssl_cert_file = '/etc/ssl/certs/ssl-cert-snakeoil.pem'\nssl_key_file = '/etc/ssl/private/ssl-cert-snakeoil.key'\nshared_buffers = 128MB\ndynamic_shared_memory_type = posix\nlog_line_prefix = '%m [%p] %q%u@%d '\nlog_timezone = 'UTC'\ndatestyle = 'iso, mdy'\ntimezone = 'UTC'\nlc_messages = 'en_US.UTF-8'\nlc_monetary = 'en_US.UTF-8'\nlc_numeric = 'en_US.UTF-8'\nlc_time = 'en_US.UTF-8'\ndefault_text_search_config = 'pg_catalog.english'\ninclude_dir = 'conf.d'"
        },
        {
          "name": "mongod.conf",
          "path": "/etc",
          "content": "# MongoDB configuration for stealth-honeypot\nsystemLog:\n  destination: file\n  logAppend: true\n  path: /var/log/mongodb/mongod.log\n\nstorage:\n  dbPath: /var/lib/mongodb\n  journal:\n    enabled: true\n\nprocessManagement:\n  fork: true\n  pidFilePath: /var/run/mongodb/mongod.pid\n  timeZoneInfo: /usr/share/zoneinfo\n\nnet:\n  port: 27017\n  bindIp: 127.0.0.1\n\nsecurity:\n  authorization: disabled\n\noperationProfiling:\n  slowOpThresholdMs: 100\n\nreplication:\n  replSetName: rs0\n\nsharding:\n  clusterRole: shardsvr"
        }
      ],
      "configurations": {
        "network": {
          "serviceType": "ssh",
          "misconfiguration": "SSH service with restricted shell bypass via maintenance account privilege escalation",
          "exploitPath": "1. Perform nmap scan to discover SSH on port 22 and other services. 2. Connect to SSH with scanner:scanner credentials (weak password). 3. Analyze restricted shell output to find maintenance account hint. 4. Crack maintenance password using pattern maint_stealth-honeypot_2023. 5. SSH as maintenance user to access chrooted environment. 6. Read flag from maintenance home directory.",
          "tools": [
            "nmap",
            "ssh",
            "hydra",
            "john"
          ],
          "servicePort": 22,
          "setup": "sudo apt update && sudo apt install -y openssh-server mysql-server postgresql mongodb apache2 && sudo systemctl enable ssh mysql postgresql mongodb apache2 && sudo systemctl start ssh mysql postgresql mongodb apache2 && sudo useradd -m -s /usr/local/bin/restricted-shell scanner && sudo useradd -m -s /bin/bash maintenance && echo 'scanner:scanner' | sudo chpasswd && echo 'maintenance:maint_stealth-honeypot_2023' | sudo chpasswd && sudo mkdir -p /var/chroot/maintenance && sudo chown maintenance:maintenance /var/chroot/maintenance && sudo chmod +x /usr/local/bin/restricted-shell",
          "difficulty": "medium",
          "hints": [],
          "learningObjectives": []
        }
      },
      "flag": "CTF{n3tw0rk_d1sc0v3ry_m4st3r_2023_ssh_pr1v_3sc}"
    }
  },
  "machineIPs": {
    "scanner-workstation": "172.26.193.3",
    "legacy-unix-server": "172.26.193.72",
    "windows-domain-controller": "172.26.193.11",
    "embedded-iot-gateway": "172.26.193.12",
    "stealth-honeypot": "172.26.193.13"
  },
  "timestamp": 1767270370017
}